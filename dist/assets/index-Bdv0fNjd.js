(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(e){if(e.ep)return;e.ep=!0;const s=o(e);fetch(e.href,s)}})();const c=document.getElementById("urlInput"),T=document.getElementById("status"),m=document.getElementById("progress"),p=document.getElementById("progressText"),v=document.getElementById("modeSwitch");let u=!1;function B(){u=!u,v.textContent=u?"MP4":"MP3"}function h(){return u}function a(t){T.textContent=t}function C(t,r){m.style.display="block",p.style.display="block",m.value=t,p.textContent=r}function d(){m.style.display="none",p.style.display="none"}function O(t,r){const o=URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=r||"download.mp3",n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)}function P(t){return[/^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)/,/^(https?:\/\/)?(www\.)?youtube\.com\/.+/].some(o=>o.test(t))}const D="http://localhost:9000",k={downloadMode:"audio",filenameStyle:"basic",audioFormat:"mp3",audioBitrate:"128",youtubeBetterAudio:!1,videoQuality:"1080",youtubeVideoCodec:"h264",youtubeVideoContainer:"mp4",youtubeHLS:!1,disableMetadata:!1,allowH265:!1,convertGif:!0,tiktokFullAudio:!1,alwaysProxy:!1,localProcessing:"disabled"},x={downloadMode:"auto",filenameStyle:"basic",audioFormat:"mp3",audioBitrate:"128",youtubeBetterAudio:!1,videoQuality:"1080",youtubeVideoCodec:"h264",youtubeVideoContainer:"mp4",youtubeHLS:!1,disableMetadata:!1,allowH265:!1,convertGif:!0,tiktokFullAudio:!1,alwaysProxy:!1,localProcessing:"disabled"};async function F(t,r=!1){const e=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({url:t,...r?x:k})});if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}async function U(t,r,o){const{onProgress:n}=o;try{n(0,"Downloading...");const e=await fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status}`);const s=e.headers.get("Estimated-Content-Length");if(!s)return await e.blob();const i=parseInt(s,10);let l=0;const y=[],E=e.body.getReader();for(;;){const{done:w,value:b}=await E.read();if(w)break;y.push(b),l+=b.length;const g=Math.round(l/i*100),M=(l/1024/1024).toFixed(2),I=(i/1024/1024).toFixed(2);n(g,`${g}% (${M}MB / ${I}MB)`)}return new Blob(y)}catch(e){throw console.error("Download error:",e),e}}let f=!1;v.addEventListener("click",()=>{B()});async function L(){var r;if(f)return;const t=c.value.trim();if(!t){a("Please paste a YouTube URL");return}if(!P(t)){a("Invalid YouTube URL");return}f=!0,d();try{a("Processing...");const o=await F(t,h());if(o.status==="tunnel"||o.status==="redirect"){const n=h()?"mp4":"mp3",e=o.filename||`download_${Date.now()}.${n}`,s=await U(o.url,e,{onProgress:(i,l)=>{a("Downloading..."),C(i,l)},onComplete:()=>{a("Download completed!"),d()},onError:i=>{a("Download failed: "+i.message),d()}});O(s,e),a("Download completed!"),d(),setTimeout(()=>{a(""),c.value=""},3e3)}else if(o.status==="error"){const n=((r=o.error)==null?void 0:r.code)||"Download failed";a(`Error: ${n}`),setTimeout(()=>a(""),5e3)}else a("Unexpected response from server"),setTimeout(()=>a(""),5e3)}catch(o){console.error("Error:",o),a("Network error: "+o.message),setTimeout(()=>a(""),5e3)}finally{f=!1}}c.addEventListener("input",async()=>{const t=c.value.trim();t&&P(t)&&!f&&setTimeout(()=>{L()},500)});c.addEventListener("keypress",async t=>{t.key==="Enter"&&await L()});console.log("Y2MP3 initialized");
