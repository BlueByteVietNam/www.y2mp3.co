(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();const l=document.getElementById("urlInput"),T=document.getElementById("status"),m=document.getElementById("progress"),p=document.getElementById("progressText"),v=document.getElementById("modeSwitch");let d=!1;function B(){d=!d,v.textContent=d?"MP4":"MP3"}function h(){return d}function r(t){T.textContent=t}function C(t,o){m.style.display="block",p.style.display="block",m.value=t,p.textContent=o}function c(){m.style.display="none",p.style.display="none"}function O(t,o){const a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=o||"download.mp3",s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}function P(t){return[/^(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)/,/^(https?:\/\/)?(www\.)?youtube\.com\/.+/].some(a=>a.test(t))}const D="http://localhost:9000",k={downloadMode:"audio",filenameStyle:"basic",audioFormat:"mp3",audioBitrate:"128",youtubeBetterAudio:!1,videoQuality:"1080",youtubeVideoCodec:"h264",youtubeVideoContainer:"mp4",youtubeHLS:!1,disableMetadata:!1,allowH265:!1,convertGif:!0,tiktokFullAudio:!1,alwaysProxy:!1,localProcessing:"disabled"},x={downloadMode:"auto",filenameStyle:"basic",audioFormat:"mp3",audioBitrate:"128",youtubeBetterAudio:!1,videoQuality:"1080",youtubeVideoCodec:"h264",youtubeVideoContainer:"mp4",youtubeHLS:!1,disableMetadata:!1,allowH265:!1,convertGif:!0,tiktokFullAudio:!1,alwaysProxy:!1,localProcessing:"disabled"};async function F(t,o=!1){const e=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({url:t,...o?x:k})});if(!e.ok)throw new Error(`HTTP ${e.status}`);return await e.json()}async function U(t,o,a){const{onProgress:s}=a;try{s(0,"Downloading...");const e=await fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status}`);const n=e.headers.get("Estimated-Content-Length");if(!n)return await e.blob();const i=parseInt(n,10);let f=0;const y=[],E=e.body.getReader();for(;;){const{done:w,value:b}=await E.read();if(w)break;y.push(b),f+=b.length;const g=Math.round(f/i*100),M=(f/1024/1024).toFixed(2),I=(i/1024/1024).toFixed(2);s(g,`${g}% (${M}MB / ${I}MB)`)}return new Blob(y)}catch(e){throw console.error("Download error:",e),e}}let u=!1;v.addEventListener("click",()=>{B()});async function L(){if(u)return;const t=l.value.trim();if(!t){r("Please paste a YouTube URL");return}if(!P(t)){r("Invalid YouTube URL");return}u=!0,c();try{r("Processing...");const o=await F(t,h());if(o.status==="tunnel"||o.status==="redirect"){const a=h()?"mp4":"mp3",s=o.filename||`download_${Date.now()}.${a}`,e=await U(o.url,s,{onProgress:(n,i)=>{r("Downloading..."),C(n,i)},onComplete:()=>{r("Download completed!"),c()},onError:n=>{r("Download failed: "+n.message),c()}});O(e,s),r("Download completed!"),c(),setTimeout(()=>{r(""),l.value=""},3e3)}else if(o.status==="error"){const a=o.error?.code||"Download failed";r(`Error: ${a}`),setTimeout(()=>r(""),5e3)}else r("Unexpected response from server"),setTimeout(()=>r(""),5e3)}catch(o){console.error("Error:",o),r("Network error: "+o.message),setTimeout(()=>r(""),5e3)}finally{u=!1}}l.addEventListener("input",async()=>{const t=l.value.trim();t&&P(t)&&!u&&setTimeout(()=>{L()},500)});l.addEventListener("keypress",async t=>{t.key==="Enter"&&await L()});console.log("Y2MP3 initialized");
